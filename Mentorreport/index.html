<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <title>Mentor: Home Page</title>
  </head>
  <body>
    <div class="container">
      <h1>Mentor activity report</h1>
      <form id="form" enctype="multipart/form-data">
        <div class="well clearfix">
          <a class="btn btn-primary pull-right add-record" data-added="0"><i class="glyphicon glyphicon-plus"></i>&nbsp;Add Row</a>
        </div>
        <table class="table table-bordered" id="tbl_posts">
          <thead>
            <tr>
              <th>#</th>
              <th>Meeting/Activity Scheduled</th>
              <th>Kept?</th>
              <th>Hours/Minutes</th>
              <th>Comments (Include goals set, accomplishments, issues)</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="tbl_posts_body">
            <tr id="rec-1">
              <td>
                <span class="sn">1</span>.
              </td>
              <td>
                <input type="text" name="activity1" placeholder="Activity" />
              </td>
              <td>
                <input type="checkbox" name="kept1" value="kept">
              </td>
              <td>
                <input type="text" name="duration1" placeholder="Duration"/>
              </td>
              <td>
                <input type="text" name="comments1" placeholder="Comments"/>
              </td>
              <td>
                <a class="btn btn-xs delete-record" data-id="1">
                <i class="glyphicon glyphicon-trash"></i>
                </a>
              </td>
            </tr>
            <tr id="rec-2">
              <td>
                <span class="sn">2</span>.
              </td>
              <td>
                <input type="text" name="activity2" placeholder="Activity"/>
              </td>
              <td>
                <input type="checkbox" name="kept2" value="kept"/>
              </td>
              <td>
                <input type="text" name="duration2" placeholder="Duration"/>
              </td>
              <td>
                <input type="text" name="comments2" placeholder="Comments"/>
              </td>
              <td>
                <a class="btn btn-xs delete-record" data-id="2">
                <i class="glyphicon glyphicon-trash"></i>
                </a>
              </td>
            </tr>
            <tr id="rec-3">
              <td>
                <span class="sn">3</span>.
              </td>
              <td>
                <input type="text" name="activity3" placeholder="Activity"/>
              </td>
              <td>
                <input type="checkbox" name="kept3" value="kept"/>
              </td>
              <td>
                <input type="text" name="duration3" placeholder="Duration"/>
              </td>
              <td>
                <input type="text" name="comments3" placeholder="Comments"/>
              </td>
              <td>
                <a class="btn btn-xs delete-record" data-id="3">
                <i class="glyphicon glyphicon-trash"></i>
                </a>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="col-sm-10" style="align-items: center;text-align: center">
          <a id="submit" class="btn btn-default read-more" style="background:#3399ff;color:white">Submit</a>
        </div>
      </form>
      <div style="display:none;">
        <table id="sample_table">
          <tr>
            <td><span class="sn"></span>.</td>
            <td><input type="text" class="act" name="activity" placeholder="Activity"/></td>
            <td><input type="checkbox" class="kept" name="kept" value="kept"/></td>
            <td><input type="text" class="dur" name="duration" placeholder="Duration"/></td>
            <td><input type="text" class="comm" name="comments" placeholder="Comments"/></td>
            <td><a class="btn btn-xs delete-record" data-id="0"><i class="glyphicon glyphicon-trash"></i></a></td>
          </tr>
        </table>
      </div>
    </div>
  </body>
  <script>
    $(document).ready(function(){
      $(document).on('click', '#submit', (function(e) {
        let form = $('#form')[0];
        let formData = new FormData(form);
        var object = {};
        formData.forEach(function(value, key){
          object[key] = value;
        });
        var json = JSON.stringify(object);
        $.ajax({
          url: 'http://127.0.0.1:8000/postMentorReport/',
          dataType: 'text',
          type: 'post',
          contentType: 'application/x-www-form-urlencoded',
          data: json,
          success: function( data, textStatus, jQxhr ){
            console.log("Success")
          },
          error: function( jqXhr, textStatus, errorThrown ){
            console.log( errorThrown );
          }
        });
      }));
    jQuery(document).delegate('a.add-record', 'click', function(e) {
      e.preventDefault();    
      var content = jQuery('#sample_table tr'),
      size = jQuery('#tbl_posts >tbody >tr').length + 1,
      element = null,    
      element = content.clone();
      element.attr('id', 'rec-'+size);
      element.find('.delete-record').attr('data-id', size);
      element.appendTo('#tbl_posts_body');
      element.find('.sn').html(size);
      element.find('.act').attr('name', 'activity' + size);
      element.find('.kept').attr('name', 'kept' + size);
      element.find('.dur').attr('name', 'duration' + size);
      element.find('.comm').attr('name', 'comments' + size);
    });
    jQuery(document).delegate('a.delete-record', 'click', function(e) {
      e.preventDefault();    
      var didConfirm = confirm("Are you sure You want to delete");
      if (didConfirm == true) {
        var id = jQuery(this).attr('data-id');
        var targetDiv = jQuery(this).attr('targetDiv');
        jQuery('#rec-' + id).remove();
        $('#tbl_posts_body tr').each(function(index){
          $(this).find('span.sn').html(index+1);
        });
        return true;
      } else {
        return false;
      }
    });
  
  });
  </script>
</html>
